# XDG Base Directory Compliance Analysis

Generated on: 2025-11-27

## Executive Summary

**Current Status:** ~40% XDG compliant
**Pragmatic Target:** ~70% compliant
**Maximum Possible:** ~85% (some tools never comply)

---

## Current State: What Already Works ‚úÖ

### Zsh Configuration (XDG-Compliant)
- **History**: `$XDG_DATA_HOME/zsh/history` (inc.history.zsh:6)
- **Zinit**: `$XDG_DATA_HOME/zinit/` (inc.zinit.zsh:2)
- **Completion cache**: `$XDG_CACHE_HOME/prezto/zcompdump` (.zlogin:5)
- **Terminfo**: `$HOME/.local/share/terminfo` (.zprofile:81)

### Tools Already Using ~/.config (via symlinks)
- aerospace
- alacritty
- atuin
- bat
- btop
- gh
- ghostty
- lazygit
- neovim
- ripgrep
- tmux

---

## Problem: Dotfile Clutter in $HOME

### Non-XDG Dotfiles Currently in $HOME
```
.android          .npm              .python_history
.aws              .php_history      .node_repl_history
.bundle           .mysql_history    .lesshst
.cargo            .fzf              .fasd (stale)
.composer         .gem              .kube
.docker           .gradle           .m2 (Maven)
.cpan/.cpanm      .luarocks
```

### Version Managers (Not XDG by default)
- `$HOME/.pyenv` - Python (pyenv)
- `$HOME/.nodenv` - Node.js (nodenv)
- `$HOME/.rbenv` - Ruby (rbenv)
- `$HOME/.cargo` - Rust toolchain
- `$HOME/.composer` - PHP packages

---

## Missing: XDG Variable Exports

Configuration uses fallback patterns but never exports the variables:
```zsh
# Current usage:
${XDG_DATA_HOME:-$HOME/.local/share}  # Fallback pattern

# Should add to .zshenv or .zprofile:
export XDG_CONFIG_HOME="${XDG_CONFIG_HOME:-$HOME/.config}"
export XDG_DATA_HOME="${XDG_DATA_HOME:-$HOME/.local/share}"
export XDG_CACHE_HOME="${XDG_CACHE_HOME:-$HOME/.cache}"
export XDG_STATE_HOME="${XDG_STATE_HOME:-$HOME/.local/state}"
```

---

## Implementation Tiers

### Tier 1: High Value, Low Risk ‚≠ê‚≠ê‚≠ê

**Impact:** Removes 6 dotfiles from `~/`, zero risk
**Effort:** 10 minutes

```zsh
# History files (clutter in $HOME)
export LESSHISTFILE="${XDG_CACHE_HOME}/less/history"
export NODE_REPL_HISTORY="${XDG_DATA_HOME}/node_repl_history"
export MYSQL_HISTFILE="${XDG_DATA_HOME}/mysql_history"

# Cloud/container configs (relocatable, well-supported)
export DOCKER_CONFIG="${XDG_CONFIG_HOME}/docker"
export AWS_CONFIG_FILE="${XDG_CONFIG_HOME}/aws/config"
export AWS_SHARED_CREDENTIALS_FILE="${XDG_CONFIG_HOME}/aws/credentials"
```

**Migration steps:**
1. Add exports to .zprofile or inc.options.zsh
2. Move existing files:
   ```bash
   mkdir -p "$XDG_CACHE_HOME/less" "$XDG_DATA_HOME" "$XDG_CONFIG_HOME"/{docker,aws}
   mv ~/.docker/* "$XDG_CONFIG_HOME/docker/" 2>/dev/null
   mv ~/.aws/* "$XDG_CONFIG_HOME/aws/" 2>/dev/null
   # History files can be discarded or moved
   ```
3. Test: docker commands, aws cli, less paging

---

### Tier 2: Medium Value, Medium Effort ‚≠ê‚≠ê

**Impact:** Cleaner, moves large data directories
**Effort:** 30-60 minutes (requires moving directories + updating PATH)

```zsh
# Version managers (large directories, but relocatable)
export PYENV_ROOT="${XDG_DATA_HOME}/pyenv"
export NODENV_ROOT="${XDG_DATA_HOME}/nodenv"
export RBENV_ROOT="${XDG_DATA_HOME}/rbenv"

# Language package managers
export CARGO_HOME="${XDG_DATA_HOME}/cargo"           # Rust
export COMPOSER_HOME="${XDG_DATA_HOME}/composer"     # PHP
export BUNDLE_USER_CONFIG="${XDG_CONFIG_HOME}/bundle"  # Ruby gems
export BUNDLE_USER_CACHE="${XDG_CACHE_HOME}/bundle"

# Build tools
export GRADLE_USER_HOME="${XDG_DATA_HOME}/gradle"
export NPM_CONFIG_USERCONFIG="${XDG_CONFIG_HOME}/npm/npmrc"
```

**Migration considerations:**
- **pyenv/nodenv/rbenv**: Already configured in inc.python.zsh, inc.nodejs.zsh, inc.ruby.zsh
  - Need to update PATH references
  - Move entire directory (can be multi-GB)
  - Test version switching after move

- **CARGO_HOME**: Rust toolchain + installed binaries
  - Update PATH: `$CARGO_HOME/bin` instead of `~/.cargo/bin`
  - Affects: Rust development, cargo-installed tools

- **COMPOSER_HOME**: PHP packages
  - Update PATH: `$COMPOSER_HOME/vendor/bin` instead of `~/.composer/vendor/bin`
  - Currently in .zprofile:43

---

### Tier 3: Low Value, High Risk ‚õî

**Skip these - not worth the pain:**

#### `.android/` - Android SDK
- Hardcoded by Android tools
- Many plugins/tools expect this exact location
- Moving breaks gradle builds, emulators, etc.

#### `.m2/` - Maven
- Java ecosystem standard
- Can override with `mvn -gs`, but project POMs may hardcode
- IntelliJ, Eclipse expect this location

#### `.kube/config` - Kubernetes
- Every k8s tool assumes `~/.kube/config`
- `KUBECONFIG` env var exists but tools inconsistent
- Helm, kubectl plugins, IDEs all expect default location

#### `.fzf.zsh` - FZF installer
- Generated by `$(brew --prefix)/opt/fzf/install`
- Installer always puts it in `~/.fzf.zsh`
- Would need to patch installer or manually maintain

#### `.gradle/` - Gradle daemon/cache
- Can move with `GRADLE_USER_HOME`
- But gradle plugins often hardcode `~/.gradle/`
- Breaking this breaks Android builds

---

## Pros and Cons of Maximum XDG Compliance

### Pros ‚úÖ

1. **Cleaner home directory**
   - `ls ~/` becomes readable
   - Visual clarity: see what matters

2. **Better organization**
   - Configs ‚Üí `~/.config/`
   - Data ‚Üí `~/.local/share/`
   - Caches ‚Üí `~/.cache/`
   - State/logs ‚Üí `~/.local/state/`

3. **Easier backups**
   - `rsync ~/.config/ backup/` backs up everything
   - Clear separation: backup configs, skip caches
   - No need to cherry-pick scattered dotfiles

4. **Portable dotfiles**
   - Fresh machine: clone dotfiles ‚Üí symlink `.config` ‚Üí done
   - Version control makes sense
   - No scattered files to track

5. **Standard compliance**
   - Modern tools expect XDG
   - Future-proof setup
   - Works with systemd user services (Linux)

6. **Less .gitignore maintenance**
   - Current: 45 lines of specific excludes
   - XDG: ignore `~/.cache/` and `~/.local/state/`, done

### Cons ‚ùå

1. **Migration pain**
   - Moving 30+ tools is tedious
   - High risk of breaking something
   - Must test every tool after moving

2. **Some tools never comply**
   - Stubborn legacy software
   - Android SDK, JVM tools, old utilities
   - You'll still have *some* dotfile clutter

3. **Tool-specific quirks**
   ```bash
   # Docker contexts may break after move
   export DOCKER_CONFIG="$XDG_CONFIG_HOME/docker"

   # AWS: many scripts assume ~/.aws/
   export AWS_CONFIG_FILE="$XDG_CONFIG_HOME/aws/config"
   # But: Terraform, CloudFormation, SDKs hardcode ~/.aws/

   # Kube: KUBECONFIG works, but tools still create ~/.kube/
   export KUBECONFIG="$XDG_CONFIG_HOME/kube/config"
   # But: helm plugins may ignore this
   ```

4. **Ecosystem fragmentation**
   - Some tools check XDG, fall back to `~/`
   - Some only check `~/`
   - Some do their own thing
   - End up fighting the ecosystem

5. **Breaking workflows**
   - Scripts hardcoded to `~/.aws/credentials`
   - Documentation assumes `~/.kube/config`
   - Coworkers' scripts may not work on your machine
   - Work-provided tools may revert changes

6. **Maintenance burden**
   - Stay on top of XDG env vars
   - New tools: "Does this respect XDG? Add override."
   - Every update: "Did they change path logic?"

7. **Diminishing returns**
   - Moving cargo/composer/npm saves clutter
   - But those are *data directories* (packages), not configs
   - Is `~/.local/share/npm` more intuitive than `~/.npm`?
   - Version managers: `~/.pyenv` is clear, `~/.local/share/pyenv` less so

---

## Recommendation: Pragmatic Partial Compliance

### Priority 1: Implement Tier 1 ‚ö°
- **Time:** 10 minutes
- **Risk:** None
- **Benefit:** Removes 6 dotfiles, standardizes configs
- **Do this:** Clean win, no downsides

### Priority 2: Consider Tier 2 ü§î
- **Time:** 30-60 minutes
- **Risk:** Medium (test thoroughly)
- **Benefit:** Significantly cleaner, moves version managers
- **Do this if:** You have time and want ~70% compliance

### Priority 3: Skip Tier 3 ‚õî
- **Time:** Hours of fighting
- **Risk:** High (ecosystem assumptions)
- **Benefit:** Minimal (tools will resist)
- **Skip this:** Not worth the pain

---

## Implementation Checklist

### Phase 1: Foundation (5 min)
- [ ] Export XDG variables in .zshenv or .zprofile
- [ ] Create directories: `mkdir -p ~/.config ~/.local/{share,state} ~/.cache`
- [ ] Verify exports: `echo $XDG_CONFIG_HOME`

### Phase 2: Tier 1 (10 min)
- [ ] Add Tier 1 exports to .zprofile or dedicated inc.xdg.zsh
- [ ] Move Docker config: `mv ~/.docker ~/.config/docker`
- [ ] Move AWS config: `mv ~/.aws ~/.config/aws`
- [ ] Test: `docker ps`, `aws s3 ls`
- [ ] Delete old history files (or move to XDG locations)
- [ ] Start new shell, verify no errors

### Phase 3: Tier 2 (optional, 60 min)
- [ ] Update PYENV_ROOT in inc.python.zsh
- [ ] Move pyenv: `mv ~/.pyenv ~/.local/share/pyenv`
- [ ] Update PATH references
- [ ] Test: `python --version`, `pyenv versions`
- [ ] Repeat for nodenv, rbenv
- [ ] Move cargo: update .zprofile PATH
- [ ] Test all version managers and toolchains

### Phase 4: Cleanup
- [ ] Update improvement plan: mark #6 as completed
- [ ] Commit changes
- [ ] Remove empty dotfile directories from `~/`

---

## Reference: XDG Base Directory Specification

### Standard Directories
- `XDG_CONFIG_HOME` - User-specific configuration files (default: `~/.config`)
- `XDG_DATA_HOME` - User-specific data files (default: `~/.local/share`)
- `XDG_CACHE_HOME` - User-specific cache files (default: `~/.cache`)
- `XDG_STATE_HOME` - User-specific state files (default: `~/.local/state`)

### What Goes Where
- **Config**: Settings, preferences (small files, should be backed up)
- **Data**: Application data, installed packages (can be large, backup selectively)
- **Cache**: Temporary data that can be regenerated (don't backup)
- **State**: Logs, history, undo files (can be large, backup selectively)

### Resources
- [XDG Base Directory Spec](https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html)
- [Arch Wiki: XDG Base Directory](https://wiki.archlinux.org/title/XDG_Base_Directory)
- [XDG Compliance Tracker](https://github.com/b3nj5m1n/xdg-ninja)

---

## Notes

- This analysis reflects the state as of 2025-11-27
- Tools and their XDG support change over time
- Test thoroughly before committing changes
- Keep backups before moving large directories
- Some tools create dotfiles on first run despite XDG exports
